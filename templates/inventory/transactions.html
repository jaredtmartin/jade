{% extends "inventory/index.html" %}
{% load i18n %}

{% load tags %}
{% block js %}
    <script type="text/javascript" src="{{MEDIA_URL}}/js/jade.js"></script> 
{% endblock %}
{% block actions %}
    {% block moreactions %}
        {% if perms.inventory.add_transaction %}<div class="actiontab" ><a onclick="$('#accounting-form').dialog('open');return false;" href="#" class="action">{% trans 'New' %}</a></div>{% endif %}
        {% if perms.inventory.view_sale %}<div class="actiontab" ><a href="/inventory/sales/?{% if q %}q={{q}}&{% endif %}{% if start %}start={{start}}&{% endif %}{% if end %}end={{end}}{% endif %}" class="action">{% trans 'Sales' %}</a></div>{% endif %}
        {% if perms.inventory.view_purchase %}<div class="actiontab" ><a href="/inventory/purchases/?{% if q %}q={{q}}&{% endif %}{% if start %}start={{start}}&{% endif %}{% if end %}end={{end}}{% endif %}" class="action">{% trans 'Purchases' %}</a></div>{% endif %}
        {% if perms.inventory.view_count %}<div class="actiontab" ><a href="/inventory/counts/?{% if q %}q={{q}}&{% endif %}{% if start %}start={{start}}&{% endif %}{% if end %}end={{end}}{% endif %}" class="action">{% trans 'Counts' %}</a></div>{% endif %}
        {% if perms.inventory.change_transfer %}<div class="actiontab" ><a href="/inventory/transfers/?{% if q %}q={{q}}&{% endif %}{% if start %}start={{start}}&{% endif %}{% if end %}end={{end}}{% endif %}" class="action">{% trans 'Transfers' %}</a></div>{% endif %}
    {% endblock%}
    <div class="actiontab" ><a href="/inventory/transactions/movements.pdf?{% if q %}q={{q}}&{% endif %}{% if start %}start={{start}}&{% endif %}{% if end %}end={{end}}{% endif %}" class="action">{% trans 'Inventory' %}</a></div>
    <div id="accounting-form" title="{% trans 'Create simple transaction' %}">
	    <form>
		    {% trans 'Doc Number' %}: <input id="doc_number" value="{{q}}" type="text"> <a href="#" onclick="$(this).prev().val('');$(this).prev().select();return false;"><img id="next_doc_number" src="{{MEDIA_URL}}/img/clear.png"/></a><br>
		    {% trans 'Debit Account' %}: <input id="debit-account" value="" type="text"><br>
		    {% trans 'Credit Account' %}: <input id="credit-account" value="" type="text"><br>
		    {% trans 'Value' %}: <input id="item" value="" type="text"><a href="#" onclick="$(this).prev().val('');$(this).prev().select();return false;"><img id="clear_value" src="{{MEDIA_URL}}/img/clear.png"/></a><br>
	    </form>
    </div>
    <script>
        function addTax(object_id){
            jQuery("#last_id").val(object_id);
            $.ajax({
                url: '/inventory/sale/'+object_id+'/get-default-tax/',
                type:'GET',
                success: showTaxMenu
            });
        }
        function showTaxMenu(){
            $('#ajax-data').replaceWith('<div id="ajax-data" style="display: none;"></div>');
            $('#ajax-data').append(data);
            $("#tax-form").dialog({
		        autoOpen: true,
		        height: 250,
		        width: 250,
		        position:['right','bottom'],
		        modal: false,
		        buttons: {
			        Close: function() {
				        $(this).dialog('close');
			        },
		            'Add': function() {
		                newTransaction('/sale/'+$('#last_id').val()+'/addtax/');
		            }
		        },
	        });
            $('#tax-form #tax').autocomplete('/inventory/tax_list/', {matchSubset:0, autoFill:1,});
        }
        $(document).ready(function(){
            $("#accounting-form").dialog({
			    autoOpen: false,
			    height: 280,
			    width: 250,
			    modal: false,
			    buttons: {
				    Close: function() {
					    $(this).dialog('close');
				    },
			        'Create': function() {
			            newTransaction('/inventory/accounting/new/');
			        }
			    },
		    });
            $('#accounting-form #debit-account').autocomplete('/inventory/account_list/', {matchSubset:0, autoFill:1,});
            $('#accounting-form #credit-account').autocomplete('/inventory/account_list/', {matchSubset:0, autoFill:1,});
            
            $('#accounting-form #value').keydown(function(e){
                if (e.keyCode == 13) {
                    newTransaction('/inventory/accounting/new/');
                    e.preventDefault();
                    return false;
                }
            });

        });
    </script>
{% endblock%}

{% block heading %}{% trans 'Transactions' %} {% endblock%}
{% block pre-table %}

    
    {% if q %}        
        {% if value %}
            <div id="totals">
                <h2>Total:${{value|floatformat:2}}</h2>
                <hr>
                <div class="clear-contentunit"></div>
            </div>
        {% endif %}
    {% endif %}
    
{% endblock%}
{% block table_header %}
    <th>{% trans 'Number' %}</th>
    <th>{% trans 'Type' %}</th>
    <th>{% trans 'Date' %}</th>
    <th>{% trans 'Account' %}</th>
    <th>{% trans 'Item' %}</th>
    <th>{% trans 'Quantity' %}</th>
    <th>{% trans 'Serial' %}</th>
    <th  class="value sale-details">{% trans 'Value' %}</th>
    <th>{% trans 'Actions' %}</th>
    <input type="hidden" id="last_id" value="">
{% endblock%}
{% block line %}
    {% with object.subclass as object %}
        {% include "inventory/transaction.html" %}
    {% endwith %}
{% endblock%}



